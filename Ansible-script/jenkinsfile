pipeline {
    agent any
    stages {
        stage('creating inventory file') {
            
            steps{
                sh '''
                    cd Ansible-script
                    ec2inventory = "myinventory\n"
                    ec2inventory += "[app_server]\n"
                    ec2inventory += "webserver1 ansible_host=${env.INSTANCE_IP} ansible_user=ubuntu\n"

                    writeFile file: 'ec2inventory', text: ec2inventory
                '''
            }
        }
            
        stage('executing ansible script') {
            
            steps{
                sh '''
                cd Ansible-script
                ansible-playbook main.yml -i ec2inventory
                '''
            }
        }
    }
}

