pipeline {
    agent any
    parameters {
        string(name: 'instance_public_ip', defaultValue: '', description: 'Public IP address of the EC2 instance')}
    stages {
        stage('creating inventory file') {
            
            steps{
                script{
                    def ec2inventory = "myinventory\n"
                    ec2inventory += "[app_server]\n"
                    ec2inventory += "${params.instance_public_ip} ansible_user=ubuntu\n"

                    writeFile file: 'Ansible-script/ec2inventory', text: ec2inventory
                }
            }
        }
            
        stage('executing ansible script') {
            
            steps{
                sh '''
                cd Ansible-script
                ansible-playbook main.yml -i ec2inventory
                '''
            }
        }
    }
}

