pipeline {
    agent any
    stages {
        stage('creating inventory file') {
            
            steps{
                script{
                    def ec2inventory = "myinventory\n"
                    ec2inventory += "[app_server]\n"
                    ec2inventory += "ansible_host=${env.INSTANCE_IP} ansible_user=ubuntu\n"

                    writeFile file: 'Ansible-script/ec2inventory', text: ec2inventory
                }
            }
        }
            
        stage('executing ansible script') {
            
            steps{
                sh '''
                cd Ansible-script
                ansible-playbook main.yml -i ec2inventory
                '''
            }
        }
    }
}

